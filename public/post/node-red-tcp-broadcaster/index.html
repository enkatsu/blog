<!DOCTYPE html>
<html lang="jp">

    <head><title>Node-REDでTCPブロードキャスト用サーバを作る &ndash; enkatsu log</title>


<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="UTF-8"/>



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin="anonymous" />


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.1/css/academicons.min.css" integrity="sha512-b1ASx0WHgVFL5ZQhTgiPWX+68KjS38Jk87jg7pe+qC7q9YkEtFq0z7xCglv7qGIs/68d3mAp+StfC8WKC5SSAg==" crossorigin="anonymous" />


<link rel="stylesheet" href="https://blog.enkatsu.org/css/palettes/base16-dark.css">
<link rel="stylesheet" href="https://blog.enkatsu.org/css/risotto.css">
<link rel="stylesheet" href="https://blog.enkatsu.org/css/custom.css">
<script src="/js/mermaid.min.js"></script>
<script>
  mermaid.initialize({ startOnLoad: true, theme: 'dark', });
  mermaid.init();
</script>







</head>

    <body>
        <div class="page">

            <header class="page__header"><nav class="page__nav main-nav">
    <ul>
    <h1 class="page__logo"><a href="https://blog.enkatsu.org" class="page__logo-inner">enkatsu log</a></h1>
    
    
    <li class="main-nav__item"><a class="nav-main-item" href="https://blog.enkatsu.org/about/" title="">About</a></li>
    
    <li class="main-nav__item"><a class="nav-main-item" href="https://blog.enkatsu.org/post/" title="">Post</a></li>
    
    <li class="main-nav__item"><a class="nav-main-item" href="https://blog.enkatsu.org/tags/" title="">Tags</a></li>
    
    </ul>
</nav>

</header>

            <section class="page__body">
    <header class="content__header">
        <h1>Node-REDでTCPブロードキャスト用サーバを作る</h1>
    </header>
    
    <div class="content__body">
        <p>最近は通信周りばかり触ってます。
とくに好きだからというわけではなく、必要があって触り始めたら色々とわかったことが多いので、
連鎖的に触ってしまっているという感じです。</p>
<p>そこで、せっかく色々と調査しているならここに書き起こしておこうと思い、
Node-REDを使ったTCPブロードキャスト用サーバの作り方について書いておきます。</p>
<p>Node-REDに今回のフローをデプロイすると、
TCPによって送信した <code>\n</code> 区切りの文字列データを、
送信先以外の接続中クライアントに配信することができます。</p>
<h1 id="node-redとは">Node-REDとは</h1>
<p>Node-REDは、デバイスやアプリケーション、Webシステムを
連携させるためのフローを組むことができるツールです。</p>
<p>IBMによって開発されましたが、現在はOpenJS Foundationによって管理されています。
フローの構築は、ブラウザ上で動作するエディタから操作することができます。
TouchDesignerやPure Dataのパッチのようにフローを構築するので、
システム間の関係性や、処理の流れを視覚的に認識することができます。</p>
<p>また、Node-REDという名前の通りNode.jsによって実装されているので、
JavaScriptによってノード内の処理を記述することもできます。</p>
<p>こちらに公式ページの文章を引用しておきます。</p>
<p><a href="https://nodered.org/" target="_blank">https://nodered.org/</a></p>
<blockquote>
<p>Node-RED is a programming tool for wiring together hardware devices, APIs and online services in new and interesting ways.
It provides a browser-based editor that makes it easy to wire together flows using the wide range of nodes in the palette that can be deployed to its runtime in a single-click.</p>
</blockquote>
<p>Node-REDは、ハードウェア、API、オンライン・サービスを面白い新しい方法で接続するためのプログラミング・ツールです。
Node-REDはブラウザベースのエディタを提供し、パレットにある様々なノードを使ったフローを、ワンクリックでランタイムにデプロイすることができます。</p>
<h1 id="実装">実装</h1>
<p>先に実装したフローを記載しておきます。
Node-REDは作成したフローをJSONで書き出し、読み込むことができます。
少し長いのでJSONは<a href="#%e3%83%95%e3%83%ad%e3%83%bc%e3%82%92%e6%9b%b8%e3%81%8d%e5%87%ba%e3%81%97%e3%81%9fjson">ページ末尾</a>に記載します。</p>
<p><img src="/images/node-red-tcp-broadcaster/flows.png" alt="flows.png"></p>
<h2 id="シーケンス図">シーケンス図</h2>
<p>3台のクライアントが接続した場合のシーケンス図はこちらです。</p>
<pre class="mermaid">
sequenceDiagram
    participant client1 as client1
    participant client2 as client2
    participant client3 as client3
    participant nodeRed as Node-RED

    client1 ->> nodeRed: 接続<br>セッションID1
    Note over nodeRed: 接続時処理<br>接続済みセッションに<br>セッションID1を追加<br>接続済みセッション: [セッションID1]
    client2 ->> nodeRed: 接続<br>セッションID2
    Note over nodeRed: 接続時処理<br>接続済みセッションに<br>セッションID2を追加<br>接続済みセッション: [セッションID1, セッションID2]
    client3 ->> nodeRed: 接続<br>セッションID3
    Note over nodeRed: 接続時処理<br>接続済みセッションに<br>セッションID3を追加<br>接続済みセッション: [セッションID1, セッションID2, セッションID3]
    
    client1 ->> nodeRed: Node-REDに 'test\n' を送信
    Note over nodeRed: 配信先セッションの配列取得<br>接続済みセッションから<br>セッションID1を<br>除いた配信先を取得<br>配信先: [セッションID2, セッションID3]
    nodeRed ->> client2: セッションID2に 'test\n' を送信
    nodeRed ->> client3: セッションID3に 'test\n' を送信

    nodeRed --> client3: 切断<br>セッションID3
    Note over nodeRed: 切断時処理<br>接続済みセッションから<br>セッションID3を削除<br>接続済みセッション: [セッションID1, セッションID2]
</pre>
<h2 id="クライアントのサンプル">クライアントのサンプル</h2>
<p>こちらに配信確認用のProcessingのコードも記載しておきます。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> processing.net.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>String host <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> port <span style="color:#f92672">=</span> 32000;
</span></span><span style="display:flex;"><span>Client client;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setup</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  size(400, 400);
</span></span><span style="display:flex;"><span>  textFont(createFont(<span style="color:#e6db74">&#34;SansSerif&#34;</span>, 16));
</span></span><span style="display:flex;"><span>  client <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Client(<span style="color:#66d9ef">this</span>, host, port);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">draw</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (client.<span style="color:#a6e22e">available</span>() <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>    String message <span style="color:#f92672">=</span> client.<span style="color:#a6e22e">readStringUntil</span>(<span style="color:#e6db74">&#39;\n&#39;</span>);
</span></span><span style="display:flex;"><span>    println(message);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">keyPressed</span>() {
</span></span><span style="display:flex;"><span>  client.<span style="color:#a6e22e">write</span>(<span style="color:#e6db74">&#34;ping\n&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="実装詳細">実装詳細</h1>
<h2 id="接続切断処理">接続・切断処理</h2>
<p>全ての処理の起点は <code>TCP:32000接続待ち受け（tcp inノード）</code> になります。</p>
<p>このノードを <code>TCP:32000接続ステータス監視（statusノード）</code> によって監視されています。
クライアントが接続または切断すると、
<code>TCP:32000接続ステータス監視（statusノード）</code> のイベントが発火します。
接続の際には <code>msg.status.event</code> プロパティは <code>connect</code> 、
切断の際には <code>msg.status.event</code> プロパティは <code>disconnect</code> になります。
<code>接続・切断の判定（switchノード）</code> は、このプロパティによって分岐します。
接続時には、フロー内で使える変数 <code>flow.sessions</code> にセッションIDを追加します。
切断時には、フロー内で使える変数 <code>flow.sessions</code> からセッションIDを削除します。
<code>接続時処理（functionノード）</code> と <code>切断時処理（functionノード）</code> のコードは下記のとおりです。</p>
<h3 id="接続時の処理">接続時の処理</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sessions</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">flow</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;sessions&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sessionId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">msg</span>.<span style="color:#a6e22e">status</span>.<span style="color:#a6e22e">_session</span>.<span style="color:#a6e22e">id</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sessions</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">sessionId</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">flow</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#39;clients&#39;</span>, <span style="color:#a6e22e">sessions</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sessionId</span>, <span style="color:#a6e22e">sessions</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">message</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">sessions</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> is connected`</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h3 id="切断時の処理">切断時の処理</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sessions</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">flow</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;sessions&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sessionId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">msg</span>.<span style="color:#a6e22e">status</span>.<span style="color:#a6e22e">_session</span>.<span style="color:#a6e22e">id</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">newSessions</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sessions</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">id</span> =&gt; <span style="color:#a6e22e">id</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">sessionId</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">flow</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#39;sessions&#39;</span>, <span style="color:#a6e22e">newSessions</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sessions</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">newSessions</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">message</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">sessionId</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> is disconnected`</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="配信処理">配信処理</h2>
<p>TCPによって受信するデータは、文字列を前提にしています。
文字列の区切り文字は <code>\n</code> になります。
受信したデータは <code>配信先セッションの配列取得（functionノード）</code> によって
以下のフォーマットの配列に整形されます。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;配信するメッセージ&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">_session</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;配信先セッションID1&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;tcp&#39;</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;配信するメッセージ&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">_session</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;配信先セッションID2&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;tcp&#39;</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>]
</span></span></code></pre></div><p>この際に、 <code>配信先セッションID</code> には受信先のIDは含まないようにフィルタリングしています。
<code>配信先セッションの配列取得（functionノード）</code> のコードは下記の通りです。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sessions</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">flow</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;sessions&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sessionId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">msg</span>.<span style="color:#a6e22e">_session</span>.<span style="color:#a6e22e">id</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">newMsg</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">newMsg</span>.<span style="color:#a6e22e">payload</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sessions</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">id</span> =&gt; <span style="color:#a6e22e">id</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">sessionId</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">id</span> =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">msg</span>.<span style="color:#a6e22e">payload</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">_session</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">id</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;tcp&#39;</span>,
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> <span style="color:#a6e22e">newMsg</span>;
</span></span></code></pre></div><p>整形された配列は、 <code>配信先セッションの配列を分割（splitノード）</code> によってメッセージ列に分割されます。
分割したメッセージは</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;配信するメッセージ&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">_session</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;配信先セッションID2&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;tcp&#39;</span>,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>のようにネストしてしまっているので、
<code>TCP:32000配信（tcp outノード）</code> に渡す前に、
<code>配信用メッセージ整形（changeノード）</code> によって</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;配信するメッセージ&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">_session</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;配信先セッションID2&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;tcp&#39;</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>のように <code>payload</code> の中身を取り出してあげる必要があります。</p>
<p>最後に、 <code>配信用メッセージ整形（changeノード）</code> によって整形されたメッセージは、
<code>TCP:32000配信（tcp outノード）</code> に渡されてクライアントに配信されます。</p>
<h1 id="まとめ">まとめ</h1>
<p>久しぶりに長々と書いてしまいました。</p>
<p>以前に、同様の処理をPythonによって開発したのですが、
スレッドを使ったりIPアドレスを管理したりで、
学生に説明するのが大変でした。
ですが、Node-REDで構築した処理なら視覚的に理解しやすいので、
説明もだいぶ楽になりそうです。</p>
<p>今回紹介したフローは、以下に記載しておきます。</p>
<h1 id="フローを書き出したjson">フローを書き出したJSON</h1>
<p><a href="/data/node-red-tcp-broadcaster/flows.json">flows.json</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;700919af87990932&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;tab&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;label&#34;</span>: <span style="color:#e6db74">&#34;TcpBroadcaster&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;disabled&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;info&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;env&#34;</span>: []
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;11fbee801eadcae3&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;tcp in&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;z&#34;</span>: <span style="color:#e6db74">&#34;700919af87990932&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;TCP:32000接続待ち受け&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;server&#34;</span>: <span style="color:#e6db74">&#34;server&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;host&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;port&#34;</span>: <span style="color:#e6db74">&#34;32000&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;datamode&#34;</span>: <span style="color:#e6db74">&#34;stream&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;datatype&#34;</span>: <span style="color:#e6db74">&#34;utf8&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;newline&#34;</span>: <span style="color:#e6db74">&#34;\\n&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;topic&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;trim&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;base64&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;tls&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;x&#34;</span>: <span style="color:#ae81ff">130</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;y&#34;</span>: <span style="color:#ae81ff">40</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;wires&#34;</span>: [
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;4a04bf1d702f3141&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;7851c2f79233a54e&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;tcp out&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;z&#34;</span>: <span style="color:#e6db74">&#34;700919af87990932&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;TCP:32000配信&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;host&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;port&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;beserver&#34;</span>: <span style="color:#e6db74">&#34;reply&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;base64&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;end&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;tls&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;x&#34;</span>: <span style="color:#ae81ff">780</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;y&#34;</span>: <span style="color:#ae81ff">80</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;wires&#34;</span>: []
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;a9b4b5e78f37319a&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;function&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;z&#34;</span>: <span style="color:#e6db74">&#34;700919af87990932&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;接続時処理&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;func&#34;</span>: <span style="color:#e6db74">&#34;const sessions = flow.get(&#39;sessions&#39;);\nconst sessionId = msg.status._session.id;\n\nsessions.push(sessionId);\nflow.set(&#39;clients&#39;, sessions);\n\nreturn {\n    payload: {\n        sessionId, sessions,\n        message: `${sessions} is connected`,\n    }\n};\n&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;outputs&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;noerr&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;initialize&#34;</span>: <span style="color:#e6db74">&#34;// ここに記述したコードは、ノードをデプロイした時に\n// 一度だけ実行されます。\nflow.set(&#39;sessions&#39;, []);\n&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;finalize&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;libs&#34;</span>: [],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;x&#34;</span>: <span style="color:#ae81ff">590</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;y&#34;</span>: <span style="color:#ae81ff">180</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;wires&#34;</span>: [
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;85c467d1e74538f8&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;4a04bf1d702f3141&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;function&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;z&#34;</span>: <span style="color:#e6db74">&#34;700919af87990932&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;配信先セッションの配列取得&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;func&#34;</span>: <span style="color:#e6db74">&#34;const sessions = flow.get(&#39;sessions&#39;);\nconst sessionId = msg._session.id;\n\nconst newMsg = {};\n\nnewMsg.payload = sessions\n    .filter(id =&gt; id !== sessionId)\n    .map(id =&gt; {\n        return {\n            payload: msg.payload,\n            _session: {\n                id,\n                type: &#39;tcp&#39;,\n            }\n        };\n    });\n\nreturn newMsg;\n&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;outputs&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;noerr&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;initialize&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;finalize&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;libs&#34;</span>: [],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;x&#34;</span>: <span style="color:#ae81ff">380</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;y&#34;</span>: <span style="color:#ae81ff">40</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;wires&#34;</span>: [
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;4ba0995388769e99&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;85c467d1e74538f8&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;debug&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;z&#34;</span>: <span style="color:#e6db74">&#34;700919af87990932&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;接続時デバッグ用&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;active&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;tosidebar&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;console&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;tostatus&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;complete&#34;</span>: <span style="color:#e6db74">&#34;payload&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;targetType&#34;</span>: <span style="color:#e6db74">&#34;msg&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;statusVal&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;statusType&#34;</span>: <span style="color:#e6db74">&#34;auto&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;x&#34;</span>: <span style="color:#ae81ff">800</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;y&#34;</span>: <span style="color:#ae81ff">180</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;wires&#34;</span>: []
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;8708d256adb4bae9&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;function&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;z&#34;</span>: <span style="color:#e6db74">&#34;700919af87990932&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;切断時処理&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;func&#34;</span>: <span style="color:#e6db74">&#34;const sessions = flow.get(&#39;sessions&#39;);\nconst sessionId = msg.status._session.id;\n\nconst newSessions = sessions\n    .filter(id =&gt; id !== sessionId);\n\nflow.set(&#39;sessions&#39;, newSessions);\n\nreturn {\n    payload: {\n        sessions: newSessions,\n        message: `${sessionId} is disconnected`,\n    },\n}&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;outputs&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;timeout&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;noerr&#34;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;initialize&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;finalize&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;libs&#34;</span>: [],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;x&#34;</span>: <span style="color:#ae81ff">590</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;y&#34;</span>: <span style="color:#ae81ff">220</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;wires&#34;</span>: [
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;4493fc979bb885a8&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;4493fc979bb885a8&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;debug&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;z&#34;</span>: <span style="color:#e6db74">&#34;700919af87990932&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;切断時デバッグ用&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;active&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;tosidebar&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;console&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;tostatus&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;complete&#34;</span>: <span style="color:#e6db74">&#34;payload&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;targetType&#34;</span>: <span style="color:#e6db74">&#34;msg&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;statusVal&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;statusType&#34;</span>: <span style="color:#e6db74">&#34;auto&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;x&#34;</span>: <span style="color:#ae81ff">800</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;y&#34;</span>: <span style="color:#ae81ff">220</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;wires&#34;</span>: []
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;4ba0995388769e99&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;split&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;z&#34;</span>: <span style="color:#e6db74">&#34;700919af87990932&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;配信先セッションの配列を分割&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;splt&#34;</span>: <span style="color:#e6db74">&#34;\\n&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;spltType&#34;</span>: <span style="color:#e6db74">&#34;str&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;arraySplt&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;arraySpltType&#34;</span>: <span style="color:#e6db74">&#34;len&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;stream&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;addname&#34;</span>: <span style="color:#e6db74">&#34;_session&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;x&#34;</span>: <span style="color:#ae81ff">270</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;y&#34;</span>: <span style="color:#ae81ff">100</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;wires&#34;</span>: [
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;043f2ee6bbe79646&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;fa65aaacca58c9cb&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;debug&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;z&#34;</span>: <span style="color:#e6db74">&#34;700919af87990932&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;配信デバッグ用&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;active&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;tosidebar&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;console&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;tostatus&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;complete&#34;</span>: <span style="color:#e6db74">&#34;true&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;targetType&#34;</span>: <span style="color:#e6db74">&#34;full&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;statusVal&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;statusType&#34;</span>: <span style="color:#e6db74">&#34;auto&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;x&#34;</span>: <span style="color:#ae81ff">790</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;y&#34;</span>: <span style="color:#ae81ff">120</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;wires&#34;</span>: []
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;7b68c19fd21af570&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;status&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;z&#34;</span>: <span style="color:#e6db74">&#34;700919af87990932&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;TCP:32000接続ステータス監視&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;scope&#34;</span>: [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;11fbee801eadcae3&#34;</span>
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;x&#34;</span>: <span style="color:#ae81ff">150</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;y&#34;</span>: <span style="color:#ae81ff">220</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;wires&#34;</span>: [
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;091c3321a37fa488&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;091c3321a37fa488&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;switch&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;z&#34;</span>: <span style="color:#e6db74">&#34;700919af87990932&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;接続・切断の判定&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;property&#34;</span>: <span style="color:#e6db74">&#34;status.event&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;propertyType&#34;</span>: <span style="color:#e6db74">&#34;msg&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;rules&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;t&#34;</span>: <span style="color:#e6db74">&#34;eq&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;v&#34;</span>: <span style="color:#e6db74">&#34;connect&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;vt&#34;</span>: <span style="color:#e6db74">&#34;str&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;t&#34;</span>: <span style="color:#e6db74">&#34;eq&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;v&#34;</span>: <span style="color:#e6db74">&#34;disconnect&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;vt&#34;</span>: <span style="color:#e6db74">&#34;str&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;t&#34;</span>: <span style="color:#e6db74">&#34;else&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;checkall&#34;</span>: <span style="color:#e6db74">&#34;false&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;repair&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;outputs&#34;</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;x&#34;</span>: <span style="color:#ae81ff">390</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;y&#34;</span>: <span style="color:#ae81ff">220</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;wires&#34;</span>: [
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;a9b4b5e78f37319a&#34;</span>
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;8708d256adb4bae9&#34;</span>
</span></span><span style="display:flex;"><span>            ],
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;bb240652b9403990&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;bb240652b9403990&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;debug&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;z&#34;</span>: <span style="color:#e6db74">&#34;700919af87990932&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;接続・切断以外デバッグ用&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;active&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;tosidebar&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;console&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;tostatus&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;complete&#34;</span>: <span style="color:#e6db74">&#34;true&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;targetType&#34;</span>: <span style="color:#e6db74">&#34;full&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;statusVal&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;statusType&#34;</span>: <span style="color:#e6db74">&#34;auto&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;x&#34;</span>: <span style="color:#ae81ff">640</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;y&#34;</span>: <span style="color:#ae81ff">260</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;wires&#34;</span>: []
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;043f2ee6bbe79646&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;change&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;z&#34;</span>: <span style="color:#e6db74">&#34;700919af87990932&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;配信用メッセージ整形&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;rules&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;t&#34;</span>: <span style="color:#e6db74">&#34;move&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;p&#34;</span>: <span style="color:#e6db74">&#34;payload._session&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;pt&#34;</span>: <span style="color:#e6db74">&#34;msg&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;to&#34;</span>: <span style="color:#e6db74">&#34;_session&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;tot&#34;</span>: <span style="color:#e6db74">&#34;msg&#34;</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;t&#34;</span>: <span style="color:#e6db74">&#34;move&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;p&#34;</span>: <span style="color:#e6db74">&#34;payload.payload&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;pt&#34;</span>: <span style="color:#e6db74">&#34;msg&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;to&#34;</span>: <span style="color:#e6db74">&#34;payload&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;tot&#34;</span>: <span style="color:#e6db74">&#34;msg&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;action&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;property&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;from&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;to&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;reg&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;x&#34;</span>: <span style="color:#ae81ff">520</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;y&#34;</span>: <span style="color:#ae81ff">100</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;wires&#34;</span>: [
</span></span><span style="display:flex;"><span>            [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;7851c2f79233a54e&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;fa65aaacca58c9cb&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div>
    </div>
    <footer class="content__footer"></footer>

            </section>

            <section class="page__aside">
                <div class="aside__about">

<ul class="aside__social-links">
    
</ul>
</div>
                <hr>
                <div class="aside__content">
    <p>Node-REDでTCPブロードキャスト用サーバを作る</p>
    
        <p>
            By Katsuya Endoh, 
            2023-11-20
        </p>
    

    

                    <div class="tags">
    
      <span class="tag">
        <a href="/tags/node-red/">[Node-RED]</a>
      </span>
      <span class="tag">
        <a href="/tags/processing/">[Processing]</a>
      </span>
      <span class="tag">
        <a href="/tags/arduino/">[Arduino]</a>
      </span></div>
  
                </div>
            </section>

            <footer class="page__footer"><p>
    
    
    
    
    
    
      
    
      
    
      
    
    
    
</p>
<br /><br />
<p class="copyright"></p>
<p class="advertisement">Powered by <a href="https://gohugo.io/">hugo</a> and <a href="https://github.com/joeroe/risotto">risotto</a>.</p>
</footer>

        </div>
    </body>

</html>
