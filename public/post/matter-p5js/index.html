<!DOCTYPE html>
<html lang="jp">

    <head><title>p5.jsとMatter.jsを組み合わせる &ndash; enkatsu log</title>


<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="UTF-8"/>



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin="anonymous" />


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.1/css/academicons.min.css" integrity="sha512-b1ASx0WHgVFL5ZQhTgiPWX+68KjS38Jk87jg7pe+qC7q9YkEtFq0z7xCglv7qGIs/68d3mAp+StfC8WKC5SSAg==" crossorigin="anonymous" />


<link rel="stylesheet" href="https://blog.enkatsu.org/css/palettes/base16-dark.css">
<link rel="stylesheet" href="https://blog.enkatsu.org/css/risotto.css">
<link rel="stylesheet" href="https://blog.enkatsu.org/css/custom.css">







</head>

    <body>
        <div class="page">

            <header class="page__header"><nav class="page__nav main-nav">
    <ul>
    <h1 class="page__logo"><a href="https://blog.enkatsu.org" class="page__logo-inner">enkatsu log</a></h1>
    
    
    <li class="main-nav__item"><a class="nav-main-item" href="https://blog.enkatsu.org/about/" title="">About</a></li>
    
    <li class="main-nav__item"><a class="nav-main-item" href="https://blog.enkatsu.org/post/" title="">Post</a></li>
    
    <li class="main-nav__item"><a class="nav-main-item" href="https://blog.enkatsu.org/tags/" title="">Tags</a></li>
    
    </ul>
</nav>

</header>

            <section class="page__body">
    <header class="content__header">
        <h1>p5.jsとMatter.jsを組み合わせる</h1>
    </header>
    
    <div class="content__body">
        <p><a href="https://p5js.org/" target="_blank">p5.js</a>と
<a href="https://github.com/liabru/matter-js" target="_blank">Matter.js</a>を
組み合わせる資料が意外と少なかったのでメモ。</p>
<h1 id="シンプルなやつ">シンプルなやつ</h1>
<p>シンプルに、staticな壁で囲んで、中にボールをいくつか入れるやつ。</p>
<video controls playsinline muted="true" width="100%" type="video/mp4" poster="/images/matter-p5js/simple.png">
  <source src="/videos/matter-p5js/simple.mov"></source>
  Sorry, your browser doesn't support embedded videos.
</video>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">http-equiv</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;X-UA-Compatible&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;IE=edge&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">title</span>&gt;circle&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdn.jsdelivr.net/npm/p5@1.5.0/lib/p5.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.18.0/matter.min.js&#34;</span> <span style="color:#a6e22e">integrity</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sha512-5T245ZTH0m0RfONiFm2NF0zcYcmAuNzcGyPSQ18j8Bs5Pbfhp5HP1hosrR8XRt5M3kSRqzjNMYpm2+it/AUX/g==&#34;</span> <span style="color:#a6e22e">crossorigin</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;anonymous&#34;</span> <span style="color:#a6e22e">referrerpolicy</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;no-referrer&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./sketch.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">body</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;background-color: #222222&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">engine</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">bodies</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">Engine</span>, <span style="color:#a6e22e">Runner</span>, <span style="color:#a6e22e">Bodies</span>, <span style="color:#a6e22e">Composite</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setup</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">createCanvas</span>(<span style="color:#ae81ff">600</span>, <span style="color:#ae81ff">600</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Engine</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Matter</span>.<span style="color:#a6e22e">Engine</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Runner</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Matter</span>.<span style="color:#a6e22e">Runner</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Bodies</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Matter</span>.<span style="color:#a6e22e">Bodies</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Composite</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Matter</span>.<span style="color:#a6e22e">Composite</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">engine</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Engine</span>.<span style="color:#a6e22e">create</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">30</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">circle</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Bodies</span>.<span style="color:#a6e22e">circle</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">width</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">random</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">100</span>),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">height</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">random</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">100</span>),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">random</span>(<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">50</span>),
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">bodies</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">circle</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">bodies</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">Bodies</span>.<span style="color:#a6e22e">rectangle</span>(<span style="color:#a6e22e">width</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span>, { <span style="color:#a6e22e">isStatic</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }));
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">bodies</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">Bodies</span>.<span style="color:#a6e22e">rectangle</span>(<span style="color:#a6e22e">width</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">height</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span>, { <span style="color:#a6e22e">isStatic</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }));
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">bodies</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">Bodies</span>.<span style="color:#a6e22e">rectangle</span>(<span style="color:#a6e22e">width</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">height</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">height</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">10</span>, { <span style="color:#a6e22e">isStatic</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }));
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">bodies</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">Bodies</span>.<span style="color:#a6e22e">rectangle</span>(<span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">height</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">height</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">10</span>, { <span style="color:#a6e22e">isStatic</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Composite</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">world</span>, <span style="color:#a6e22e">bodies</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">runner</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Runner</span>.<span style="color:#a6e22e">create</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Runner</span>.<span style="color:#a6e22e">run</span>(<span style="color:#a6e22e">runner</span>, <span style="color:#a6e22e">engine</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">draw</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">background</span>(<span style="color:#ae81ff">50</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">bodies</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#a6e22e">body</span> =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">push</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fill</span>(<span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">200</span>, <span style="color:#ae81ff">250</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">stroke</span>(<span style="color:#ae81ff">255</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">beginShape</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">vertices</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#a6e22e">v</span> =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">vertex</span>(<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">y</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">endShape</span>(<span style="color:#a6e22e">CLOSE</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pop</span>();
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="レンダリングは少し変えたやつ">レンダリングは少し変えたやつ</h1>
<p>物理演算でレイアウトする必要があったので、その際のコードも置いておく。
シンプルなやつの、ボールに内接する正方形をレンダリングするやつ。</p>
<video controls playsinline muted="true" width="100%" type="video/mp4" poster="/images/matter-p5js/matter-p5js.png">
  <source src="/videos/matter-p5js/matter-p5js.mov"></source>
  Sorry, your browser doesn't support embedded videos.
</video>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">http-equiv</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;X-UA-Compatible&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;IE=edge&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">title</span>&gt;circle&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdn.jsdelivr.net/npm/p5@1.5.0/lib/p5.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.18.0/matter.min.js&#34;</span> <span style="color:#a6e22e">integrity</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sha512-5T245ZTH0m0RfONiFm2NF0zcYcmAuNzcGyPSQ18j8Bs5Pbfhp5HP1hosrR8XRt5M3kSRqzjNMYpm2+it/AUX/g==&#34;</span> <span style="color:#a6e22e">crossorigin</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;anonymous&#34;</span> <span style="color:#a6e22e">referrerpolicy</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;no-referrer&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./sketch.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">body</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;background-color: #222222&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">engine</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">bodies</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">Engine</span>, <span style="color:#a6e22e">Runner</span>, <span style="color:#a6e22e">Bodies</span>, <span style="color:#a6e22e">Composite</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">displayBody</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setup</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">createCanvas</span>(<span style="color:#ae81ff">600</span>, <span style="color:#ae81ff">600</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">rectMode</span>(<span style="color:#a6e22e">CENTER</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Engine</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Matter</span>.<span style="color:#a6e22e">Engine</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Runner</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Matter</span>.<span style="color:#a6e22e">Runner</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Bodies</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Matter</span>.<span style="color:#a6e22e">Bodies</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Composite</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Matter</span>.<span style="color:#a6e22e">Composite</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">engine</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Engine</span>.<span style="color:#a6e22e">create</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">30</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">circle</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Bodies</span>.<span style="color:#a6e22e">circle</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">width</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">random</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">100</span>),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">height</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">random</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">100</span>),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">random</span>(<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">50</span>),
</span></span><span style="display:flex;"><span>      { <span style="color:#a6e22e">visible</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">angle</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">random</span>(<span style="color:#a6e22e">PI</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>) }
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">bodies</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">circle</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">bodies</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">Bodies</span>.<span style="color:#a6e22e">rectangle</span>(<span style="color:#a6e22e">width</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span>, { <span style="color:#a6e22e">isStatic</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">visible</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span> }));
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">bodies</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">Bodies</span>.<span style="color:#a6e22e">rectangle</span>(<span style="color:#a6e22e">width</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">height</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">width</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span>, { <span style="color:#a6e22e">isStatic</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">visible</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span> }));
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">bodies</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">Bodies</span>.<span style="color:#a6e22e">rectangle</span>(<span style="color:#a6e22e">width</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">height</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">height</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">10</span>, { <span style="color:#a6e22e">isStatic</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">visible</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span> }));
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">bodies</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">Bodies</span>.<span style="color:#a6e22e">rectangle</span>(<span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">height</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">height</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">10</span>, { <span style="color:#a6e22e">isStatic</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">visible</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span> }));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Composite</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">world</span>, <span style="color:#a6e22e">bodies</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">runner</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Runner</span>.<span style="color:#a6e22e">create</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Runner</span>.<span style="color:#a6e22e">run</span>(<span style="color:#a6e22e">runner</span>, <span style="color:#a6e22e">engine</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">draw</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">background</span>(<span style="color:#ae81ff">255</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">bodies</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#a6e22e">body</span> =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">displayBody</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">push</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">noFill</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">stroke</span>(<span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">50</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">beginShape</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">vertices</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#a6e22e">v</span> =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">vertex</span>(<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">y</span>);
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">endShape</span>(<span style="color:#a6e22e">CLOSE</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">pop</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">visible</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">position</span>.<span style="color:#a6e22e">x</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">y</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">position</span>.<span style="color:#a6e22e">y</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">circleWidth</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">bounds</span>.<span style="color:#a6e22e">max</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">bounds</span>.<span style="color:#a6e22e">min</span>.<span style="color:#a6e22e">x</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">w</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">circleWidth</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">*</span> Math.<span style="color:#a6e22e">sqrt</span>(<span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">push</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">noFill</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">stroke</span>(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">translate</span>(<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">rotate</span>(<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">angle</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">square</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">w</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">10</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pop</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// textAlign(CENTER, CENTER);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// text(degrees(body.angle).toFixed(2), x, y);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
    </div>
    <footer class="content__footer"></footer>

            </section>

            <section class="page__aside">
                <div class="aside__about">

<ul class="aside__social-links">
    
</ul>
</div>
                <hr>
                <div class="aside__content">
    <p>p5.jsとMatter.jsを組み合わせる</p>
    
        <p>
            By Katsuya Endoh, 
            2023-01-05
        </p>
    

    

                    <div class="tags">
    
      <span class="tag">
        <a href="/tags/p5.js/">[p5.js]</a>
      </span>
      <span class="tag">
        <a href="/tags/matter.js/">[Matter.js]</a>
      </span></div>
  
                </div>
            </section>

            <footer class="page__footer"><p>
    
    
    
    
    
    
      
    
      
    
      
    
    
    
</p>
<br /><br />
<p class="copyright"></p>
<p class="advertisement">Powered by <a href="https://gohugo.io/">hugo</a> and <a href="https://github.com/joeroe/risotto">risotto</a>.</p>
</footer>

        </div>
    </body>

</html>
